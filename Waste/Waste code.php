<div id="accordion">
                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h5 class="mb-0">
                      <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Collapsible Group Item #1
                      </button>
                    </h5>
                  </div>
              
                  <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                      Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably havent heard of them accusamus labore sustainable VHS.
                    </div>
                  </div>
                </div>
                <div class="card">
                  <div class="card-header" id="headingTwo">
                    <h5 class="mb-0">
                      <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Collapsible Group Item #2
                      </button>
                    </h5>
                  </div>
                  <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                    <div class="card-body">
                      Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably havent heard of them accusamus labore sustainable VHS.
                    </div>
                  </div>
                </div>
                <div class="card">
                  <div class="card-header" id="headingThree">
                    <h5 class="mb-0">
                      <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        Collapsible Group Item #3
                      </button>
                    </h5>
                  </div>
                  <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                    <div class="card-body">
                      Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor, sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably havent heard of them accusamus labore sustainable VHS.
                    </div>
                  </div>
                </div>
              </div> 




              <div id="accordion">
                    <div class="card">
                        <div class="card-header" id="headingOne">
                            <h5 class="mb-0">
                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                    Collapsible Group Item #1
                                </button>
                            </h5>
                        </div>
                        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                            <div class="card-body">
                                data
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-6">
                        <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Special title treatment</h5>
                            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                            <a href="#" class="btn btn-primary">Go somewhere</a>
                        </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Special title treatment</h5>
                                <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
                                <a href="#" class="btn btn-primary">Go somewhere</a>
                            </div>
                        </div>
                    </div>
                </div>

                    // $payments_query = "SELECT payments_staging.BILL_DT,
                    //                             payments_staging.PAYMENT_DATE,
                    //                             payments_staging.PAYMENT_AMOUNT
                    //                     FROM payments_staging, placement_info
                    //                     WHERE payments_staging.BILL_NO=$row ['BILL_NO']";








                                // <div class="container mb-3 mt-2">
            //         <div class="row row-down">         
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BILL_NO'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BAL_TOTAL'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['DUE_DT'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BALANCE_0_30'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BALANCE_31_60'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BALANCE_61_90'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BALANCE_91_180'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BAL_181_360'].'</div>
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BAL_360_PLUS'].'</div>    
            //             <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['cycle_id'].'</div>   
            //             <div style="margin-top:-4px; !important" class="col-1"> <button type="button" onclick="show('.$row ['BILL_NO'].')"  class="details-btn clickMe">Details</button></div>                       
            //         </div>

                
            //         <div style="display:none;" id='.$row ['BILL_NO'].'>
            //             <table style="box-shadow: 3px 0px 3px #00000030;" class="table table-sm table-striped">                        
            //                 <tr>
            //                     <th class="font-weight-light small" scope="col">Bill Date</th>
            //                     <th class="font-weight-light small" scope="col">Payment Date</th>
            //                     <th class="font-weight-light small"scope="col">Payment</th>
            //                     <th class="small" style="color:red !important;cursor:pointer" scope="col" onclick="hide('.$row ['BILL_NO'].')">X</a></th>
            //                 </tr>
            //                 <tbody>
            //                     <tr>
            //                     <td style="color: rgb(92, 91, 91);" class="small"> '.$row ['BILL_DT'].'</td>
            //                     <td style="color: rgb(92, 91, 91);" class="small"> '.$row ['PAYMENT_DATE'].'</td>
            //                     <td style="color: rgb(92, 91, 91);" class="small"> '.$row ['PAYMENT_AMOUNT'].'</td>
            //                     <td></td>
            //                     </tr>
            //                 </tbody>
            //             </table>      
            //         </div>
            //     </div>




                    <ul class="nav nav-tabs md-tabs" id="myTabMD" role="tablist">
                    <li class="nav-item">
                    <a class="nav-link active" id="home-tab-md" data-toggle="tab" href="#home-md" role="tab" aria-controls="home-md"
                        aria-selected="true">Placements</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" id="profile-tab-md" data-toggle="tab" href="#profile-md" role="tab" aria-controls="profile-md"
                        aria-selected="false">Payment</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" id="contact-tab-md" data-toggle="tab" href="#contact-md" role="tab" aria-controls="contact-md"
                        aria-selected="false">Promises Made</a>
                    </li>
                </ul>
                <div class="tab-content card pt-5" id="myTabContentMD">
                    <div class="tab-pane fade show active" id="home-md" role="tabpanel" aria-labelledby="home-tab-md">
                        <p>Data</p>
                    </div>
                    <div class="tab-pane fade" id="profile-md" role="tabpanel" aria-labelledby="profile-tab-md">  

           
                    </div>
                    <div class="tab-pane fade" id="contact-md" role="tabpanel" aria-labelledby="contact-tab-md">
                        <p>Data</p>
                    </div>
                </div>
                <br>
        <h4 class="bold text-col mt-3">History</h4>
        <div class="container">
        <div class="row">
          <div class="small col bold text-col">Bill Number</div>
          <div class="small col bold text-col">Bal Total</div>
          <div class="small col bold text-col">Due Date</div>
          <div class="small col bold text-col">Bal 0-30</div>
          <div class="small col bold text-col">Bal 31-60</div>
          <div class="small col bold text-col">Bal 61-90</div>
          <div class="small col bold text-col">Bal 91-180</div>
          <div class="small col bold text-col">Bal 181-360</div>
          <div class="small col bold text-col">Bal 360+</div>
          <div class="small col bold text-col">Bill cycle</div>
          <div class="col"></div>
          </div>
          </div>
       
        



<ul class="nav nav-tabs nav-justified md-tabs indigo" id="myTabJust" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="Placements" data-toggle="tab" href="#Placements" role="tab" aria-controls="Placements"
      aria-selected="true">Placement</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="Payment" data-toggle="tab" href="#Payment" role="tab" aria-controls="Payment"
      aria-selected="false">Payments</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="Promise" data-toggle="tab" href="#Promises Made" role="tab" aria-controls="Promises Made"
      aria-selected="false">Promises</a>
  </li>
</ul>
<div class="tab-content card pt-5" id="myTabContentJust">
  <div class="tab-pane fade show active" id="Placements" role="tabpanel" aria-labelledby="home-tab-just">
    <p>Data</p>
  </div>
  <div class="tab-pane fade" id="Payment" role="tabpanel" aria-labelledby="profile-tab-just">
    <p>Data</p>
  </div>
  <div class="tab-pane fade" id="Promises Made" role="tabpanel" aria-labelledby="contact-tab-just">
    <p>Data</p>
  </div>
</div>


<br>
                            <div style="color: rgb(92, 91, 91);" class="col small"> '.$row ['BILL_NO'].'</div>
                            <br>
                            <ul class="nav nav-tabs nav-justified md-tabs indigo" id="myTabJust" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="Placements" data-toggle="tab" href="#Placements" role="tab" aria-controls="Placements"
                                    aria-selected="true">Placement</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="Payment" data-toggle="tab" href="#Payment" role="tab" aria-controls="Payment"
                                    aria-selected="false">Payments</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="Promise" data-toggle="tab" href="#Promises Made" role="tab" aria-controls="Promises Made"
                                    aria-selected="false">Promises</a>
                                </li>
                            </ul>
                            <div class="tab-content card pt-5" id="myTabContentJust">
                                <div class="tab-pane fade show active" id="Placements" role="tabpanel" aria-labelledby="home-tab-just">
                                    <p>Data</p>
                                </div>
                                <div class="tab-pane fade" id="Payment" role="tabpanel" aria-labelledby="profile-tab-just">
                                    <p>Data</p>
                                </div>
                                <div class="tab-pane fade" id="Promises Made" role="tabpanel" aria-labelledby="contact-tab-just">
                                    <p>Data</p>
                                </div>
                            </div>
                            <br>


                            SELECT  
                                    placement_info.FIRST_NAME,
                                    placement_info.LAST_NAME,
                                    placement_info.ACCOUNT_NO,  
                                    placement_info.BILL_NO,
                                    placement_info.BALANCE_0_30,
                                    placement_info.BALANCE_31_60,
                                    placement_info.BALANCE_61_90,
                                    placement_info.BALANCE_91_180,
                                    placement_info.BAL_181_360,
                                    placement_info.BAL_360_PLUS,
                                    placement_info.BAL_TOTAL,
                                    placement_info.cycle_id,
                                    placement_info.DUE_DT
                                FROM placement_info
                                WHERE placement_info.ACCOUNT_NO = $query


<br>
                            
                            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Profile</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Contact</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="pills-tabContent">
                                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">

                                    <dl class="row">
                                        <dt class="col-sm-3">First Name</dt>
                                        <dd class="col-sm-9">Some Name</dd>
                                    
                                        <dt class="col-sm-3">First Name</dt>
                                        <dd class="col-sm-9">Some Name</dd>
                                    
                                        <dt class="col-sm-3">Balance Total</dt>
                                        <dd class="col-sm-9">$00000000</dd>
                                    
                                        <dt class="col-sm-3 text-truncate">Due Date</dt>
                                        <dd class="col-sm-9">Feb 16, 2019</dd>

                                        <dt class="col-sm-3 text-truncate">Bal 0-30 </dt>
                                        <dd class="col-sm-9">$00000</dd>

                                        <dt class="col-sm-3 text-truncate">Bal 61-90</dt>
                                        <dd class="col-sm-9">$00000</dd>
                                        
                                        <dt class="col-sm-3 text-truncate">Bal 91-180</dt>
                                        <dd class="col-sm-9">$00000</dd>

                                        <dt class="col-sm-3 text-truncate">Bal 181-360</dt>
                                        <dd class="col-sm-9">$00000</dd>

                                        <dt class="col-sm-3 text-truncate">Bal 360+</dt>
                                        <dd class="col-sm-9">$00000</dd>

                                        <dt class="col-sm-3 text-truncate">Bal 360+</dt>
                                        <dd class="col-sm-9">$00000</dd>

                                        <dt class="col-sm-3 text-truncate">Billing Cycle</dt>
                                        <dd class="col-sm-9">$00000</dd>
                                    </dl>
                                </div>
                                <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                                    <dl class="row">
                                        <dt class="col-sm-3">Description lists2</dt>
                                        <dd class="col-sm-9">A description list is perfect for defining terms.</dd>
                                    
                                        <dt class="col-sm-3">Euismod</dt>
                                        <dd class="col-sm-9">
                                        <p>Vestibulum id ligula porta felis euismod semper eget lacinia odio sem nec elit.</p>
                                        <p>Donec id elit non mi porta gravida at eget metus.</p>
                                        </dd>
                                    
                                        <dt class="col-sm-3">Malesuada porta</dt>
                                        <dd class="col-sm-9">Etiam porta sem malesuada magna mollis euismod.</dd>
                                    
                                        <dt class="col-sm-3 text-truncate">Truncated term is truncated</dt>
                                        <dd class="col-sm-9">Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</dd>
                                    
                                        <dt class="col-sm-3">Nesting</dt>
                                        <dd class="col-sm-9">
                                        <dl class="row">
                                            <dt class="col-sm-4">Nested definition list</dt>
                                            <dd class="col-sm-8">Aenean posuere, tortor sed cursus feugiat, nunc augue blandit nunc.</dd>
                                        </dl>
                                        </dd>
                                    </dl>
                                </div>
                                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
                                    <dl class="row">
                                        <dt class="col-sm-3">Description lists3</dt>
                                        <dd class="col-sm-9">A description list is perfect for defining terms.</dd>
                                    
                                        <dt class="col-sm-3">Euismod</dt>
                                        <dd class="col-sm-9">
                                        <p>Vestibulum id ligula porta felis euismod semper eget lacinia odio sem nec elit.</p>
                                        <p>Donec id elit non mi porta gravida at eget metus.</p>
                                        </dd>
                                    
                                        <dt class="col-sm-3">Malesuada porta</dt>
                                        <dd class="col-sm-9">Etiam porta sem malesuada magna mollis euismod.</dd>
                                    
                                        <dt class="col-sm-3 text-truncate">Truncated term is truncated</dt>
                                        <dd class="col-sm-9">Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</dd>
                                    
                                        <dt class="col-sm-3">Nesting</dt>
                                        <dd class="col-sm-9">
                                            <dl class="row">
                                                <dt class="col-sm-4">Nested definition list</dt>
                                                <dd class="col-sm-8">Aenean posuere, tortor sed cursus feugiat, nunc augue blandit nunc.</dd>
                                            </dl>   
                                        </dd>
                                    </dl>
                                </div>
                            </div>




                            <dt class="col-sm-3 text-truncate"></dt>

 // echo($account_num_query);
        // $payment_staging_query="SELECT
        //                                 payments_staging.BILL_DT,
        //                                 paymsent_staging.PAYMENT_DATE,
        //                                 payments_staging.PAYMENT_AMOUNT
        //                         FROM payments_staging
        //                         WHERE placement_info.BILL_NO=$lastrow['BILL_NO']";


       
        // function get_payments(){
        //     $payment_staging_query = htmlspecialchars($payment_staging_query);
        //     $payment_staging_query_result = mysqli_query($connection_2, $payment_staging_query);
        //     if($payment_staging_query_result->num_rows >0)
        //     {
        //         while($payment_row = mysqli_fetch_array($payment_staging_query_result))
        //         {
        //             echo'
        //                     <table class="table table-hover">
        //                         <thead>
        //                             <tr>
        //                                 <th scope="col">Payment Type</th>
        //                                 <th scope="col">Amount</th>
        //                                 <th scope="col">Date</th>
        //                             </tr>
        //                         </thead>
        //                         <tbody>
        //                             <tr>
        //                                 <td>Something</td>
        //                                 <td>Otto</td>
        //                                 <td>@mdo</td>
        //                             </tr>
        //                             <tr>
        //                                 <td scope="row">2</td>
        //                                 <td>Jacob</td>
        //                                 <td>Thornton</td>
        //                             </tr>
        //                             <tr>
        //                                 <td scope="row">2</td>
        //                                 <td>Jacob</td>
        //                                 <td>Thornton</td>
        //                             </tr>
        //                         </tbody>
        //                     </table>'
        //         };



      
                                       SELECT payments_staging.BILL_DT,
                                        paymsent_staging.PAYMENT_DATE,
                                        payments_staging.PAYMENT_AMOUNT
                                FROM payments_staging
                                WHERE placement_info.BILL_NO=17649007



SELECT payments_staging.PAYMENT_DATE,
       'Payment' as 'Type',
       'SYSTEM' as 'Promised/Paid By',
       payments_staging.PAYMENT_AMOUNT                              
FROM payments_staging
WHERE payments_staging.BILL_NO=17649007
UNION ALL
SELECT  ptp_info.date_promised,
		'Promise' as 'Type',
		ptp_info.amt_promised,
		ptp_info.PROMISE_BY
		
FROM  placement_info
INNER JOIN ptp_info ON placement_info.placement_id=ptp_info.placement_id_fk
WHERE placement_info.BILL_NO=17649007
``                                



SELECT payments_staging.PAYMENT_DATE AS DATE,
       'Payment' as 'Type',
       'SYSTEM' as 'PROMISE_BY',
       payments_staging.PAYMENT_AMOUNT AS AMOUNT                             
FROM payments_staging
WHERE payments_staging.BILL_NO=17243400
UNION ALL
SELECT ptp_info.date_promised AS DATE, 'Promise' AS 'Type', ptp_info.PROMISE_BY, ptp_info.amt_promised AS AMOUNT
FROM placement_info
INNER JOIN ptp_info ON placement_info.placement_id = ptp_info.placement_id_fk
WHERE placement_info.BILL_NO =17243400                  
                                                    



                                .
                                                
                                                
                                            
                                                while($payment_row = mysqli_fetch_array($payment_staging_query_result))
                                                {
                                                    // echo'
                                                    //         <table class="table table-hover">
                                                    //             <thead>
                                                    //                 <tr>
                                                    //                     <th scope="col">BILL_DT</th>
                                                    //                     <th scope="col">Payment Date</th>
                                                    //                     <th scope="col">Payment Amount</th>
                                                    //                 </tr>
                                                    //             </thead>
                                                    //             <tbody>
                                                    //                 <tr>
                                                    //                     <td>'.$payment_row['BILL_DT'].'</td>
                                                    //                     <td>'.$payment_row['PAYMENT_DATE'].'</td>
                                                    //                     <td>'.$payment_row['PAYMENT_AMOUNT'].'</td>
                                                    //                 </tr>
                                                    //                 <tr>
                                                    //                     <td scope="row">2</td>
                                                    //                     <td>Jacob</td>
                                                    //                     <td>Thornton</td>
                                                    //                 </tr>
                                                    //                 <tr>
                                                    //                     <td scope="row">2</td>
                                                    //                     <td>Jacob</td>
                                                    //                     <td>Thornton</td>
                                                    //                 </tr>
                                                    //             </tbody>
                                                    //         </table>';
                                                    echo('work work work work');
                                                }



                                                SELECT date_promised, 'payment' AS 'type' FROM `ptp_info` WHERE 1







SELECT ptp_info.date_promised AS DATE, 'Promise' AS 'Type', ptp_info.PROMISE_BY, ptp_info.amt_promised AS AMOUNT
FROM placement_info
INNER JOIN ptp_info ON placement_info.placement_id = ptp_info.placement_id_fk
WHERE placement_info.BILL_NO =19421357


SELECT payments_staging.PAYMENT_DATE AS DATE,
                                                                'Payment' as 'Type',
                                                                'SYSTEM' as PROMISE_BY,
                                                                payments_staging.PAYMENT_AMOUNT AS AMOUNT                             
                                                        FROM payments_staging
                                                        WHERE payments_staging.BILL_NO=19421357
                                                        UNION ALL
                                                        SELECT ptp_info.date_promised AS DATE, 'Promise' AS 'Type', ptp_info.PROMISE_BY, ptp_info.amt_promised AS AMOUNT
                                                        FROM placement_info
                                                        INNER JOIN ptp_info ON placement_info.placement_id = ptp_info.placement_id_fk
                                                        WHERE placement_info.BILL_NO =19421357
                                                        order by cast([DATE] as datetime) asc



SELECT payments_staging.PAYMENT_DATE AS DATE,
		'Payment' as 'Type',
        'SYSTEM' as PROMISE_BY,
		payments_staging.PAYMENT_AMOUNT AS AMOUNT                             
FROM payments_staging
WHERE payments_staging.BILL_NO=17243400
UNION ALL
SELECT ptp_info.date_promised AS DATE, 'Promise' AS 'Type', ptp_info.PROMISE_BY, ptp_info.amt_promised AS AMOUNT
FROM placement_info
INNER JOIN ptp_info ON placement_info.placement_id = ptp_info.placement_id_fk
WHERE placement_info.BILL_NO =17243400
order by cast([DATE] as datetime) asc








<?php
    // initialize session
    session_start();
    
    include("authenticate.php");
    
    // check to see if user is logging out
    if(isset($_GET['out'])) {
        // destroy session
        session_unset();
        $_SESSION = array();
        unset($_SESSION['user'],$_SESSION['access']);
        session_destroy();
    }
    
    // check to see if login form has been submitted
    if(isset($_POST['userLogin'])){
        echo();
        // run information through authenticator
        if(authenticate($_POST['userLogin'],$_POST['userPassword']))
        {
            // authentication passed
            echo("dap work");
            //header("Location: protected.php");
            die();
        } else {
            // authentication failed
            $error = 1;
        }
    }
    
    // output error to user
    if(isset($error)) echo "Login failed: Incorrect username, password, or rights<br/>";
    
    // output logout success
    if(isset($_GET['out'])) echo "Logout successful";
?>



		// check groups
		$access = 0;
		foreach($entries[0]['memberof'] as $grps) {
			// is manager, break loop
			if(strpos($grps, $ldap_manager_group)) { $access = 2; break; }

			// is user
			if(strpos($grps, $ldap_user_group)) $access = 1;
		}

		if($access != 0) {
			// establish session variables
			$_SESSION['user'] = $user;
			$_SESSION['access'] = $access;
			return true;
		} else {
			// user has no rights
			return false;
		}


<?php
function authenticate($user, $password)
{
	if(empty($user) || empty($password)) return false;

	// active directory server
	$ldap_host = "global.com";

	// active directory DN (base location of ldap search)
	$ldap_dn = "DC=global,DC=com";

	// active directory user group name
	$ldap_user_group = "Domain Users";

	// active directory manager group name
	//$ldap_manager_group = "WebManagers";

	// domain, for purposes of constructing $user
	$ldap_usr_dom = '@global.com';

	// connect to active directory
	$ldap = ldap_connect($ldap_host);

	// configure ldap params
	ldap_set_option($ldap,LDAP_OPT_PROTOCOL_VERSION,3);
	ldap_set_option($ldap,LDAP_OPT_REFERRALS,0);

	// verify user and password
	if($bind = @ldap_bind($ldap, $user.$ldap_usr_dom, $password)) {
		// valid
		// check presence in groups
		echo('we in the bind');
		$access = 0;
		$filter = "(sAMAccountName=".$user.")";
		$attr = array("memberof");
		$result = ldap_search($ldap, $ldap_dn, $filter, $attr) or exit("Unable to search LDAP server");
		$entries = ldap_get_entries($ldap, $result);
		ldap_unbind($ldap);
		$_SESSION['user'] = $user;
		$_SESSION['access'] = $access;		

	} else {
		// invalid name or password
		return false;
	}
}
?>


<?php
function authenticate($user, $password)
{
	//set_time_limit(30);
	if(empty($user) || empty($password)) return false;
	error_reporting(E_ALL);
	ini_set('error_reporting', E_ALL);
	ini_set('display_errors',1);
	
	// config
	$ldapserver = 'global.com';
	$ldaptree    = "DC=GLOBAL,DC=COM";
	
	// connect 
	$ldapconn = ldap_connect($ldapserver) or die("Could not connect to LDAP server.");
	echo('we connected');
	if($ldapconn) {
	    // binding to ldap server
	    $ldapbind = ldap_bind($ldapconn, $ldapuser, $ldappass) or die ("Error trying to bind: ".ldap_error($ldapconn));
	    // verify binding
	    if ($ldapbind) {
	        echo "LDAP bind successful...<br /><br />";
	        
	        
	        $result = ldap_search($ldapconn,$ldaptree, "(cn=*)") or die ("Error in search query: ".ldap_error($ldapconn));
	        $data = ldap_get_entries($ldapconn, $result);
	        
	        // SHOW ALL DATA
	        echo '<h1>Dump all data</h1><pre>';
	        print_r($data);    
	        echo '</pre>';
	        
	        
	        // iterate over array and print data for each entry
	        echo '<h1>Show me the users</h1>';
	        for ($i=0; $i<$data["count"]; $i++) {
	            //echo "dn is: ". $data[$i]["dn"] ."<br />";
	            echo "User: ". $data[$i]["cn"][0] ."<br />";
	            if(isset($data[$i]["mail"][0])) {
	                echo "Email: ". $data[$i]["mail"][0] ."<br /><br />";
	            } else {
	                echo "Email: None<br /><br />";
	            }
	        }
	        // print number of entries found
	        echo "Number of entries found: " . ldap_count_entries($ldapconn, $result);
	    } else {
	        echo "LDAP bind failed...";
	    }
	
	}
	
	// all done? clean up
	ldap_close($ldapconn);
}
?>



<?php
    // initialize session
    session_start();
    
    
    include("authenticate.php");
    echo('authenticate line');
    
    // check to see if user is logging out
    if(isset($_GET['out'])) {
        // destroy session
        session_unset();
        $_SESSION = array();
        unset($_SESSION['user'],$_SESSION['access']);
        session_destroy();
    }
    
    // // check to see if login form has been submitted
    if(isset($_POST['userLogin'])){
        echo('test test test');
        // run information through authenticator
        if(authenticate($_POST['userLogin'],$_POST['userPassword']))
        {
            // authentication passed
            echo('<br>dap work<br>');
            header('Location: Promise-to-pay-form.php');
            die();
        } else {
            // authentication failed
            echo('the authentification failed');
            $error = 1;
        }
    }
    
    // // output error to user
    if(isset($error)) echo "Login failed: Incorrect username, password, or rights<br/>";
    
    // // output logout success
    // if(isset($_GET['out'])) echo "Logout successful";
?>



// $filter="(sAMAccountName=$username)";
            // $result = ldap_search($ldap,"dc=MYDOMAIN,dc=COM",$filter);
            // ldap_sort($ldap,$result,"sn");
            // $info = ldap_get_entries($ldap, $result);
            // for ($i=0; $i<$info["count"]; $i++)
            // {
            //     if($info['count'] > 1)
            //         break;
            //     echo "<p>You are accessing <strong> ". $info[$i]["sn"][0] .", " . $info[$i]["givenname"][0] ."</strong><br /> (" . $info[$i]["samaccountname"][0] .")</p>\n";
            //     echo '<pre>';
            //     var_dump($info);
            //     echo '</pre>';
            //     $userDn = $info[$i]["distinguishedname"][0]; 
            // }
            // if ( is_session_started() === FALSE ){
            //     session_start();
            // }